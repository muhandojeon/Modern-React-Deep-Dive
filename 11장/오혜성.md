# Next.js 13κ³Ό λ¦¬μ•΅νΈ 18

## Next.js 13 App dir

* _documentμ—μ„ ν•λ CSS-in-JS μ΄κΈ°ν™” λ΅μ§μ„ λ£¨νΈ λ μ΄μ•„μ›ƒμ—μ„ μ μ©
  + `useServerInsertedHtml`
    - https://nextjs.org/docs/app/building-your-application/styling/css-in-js
    - κ³Όκ±° useFlushEffectsλΌλ” μ΄λ¦„μ ν›…μ΄μ€μ
    - useInsertionEffectλ¥Ό κΈ°λ°μΌλ΅ ν•¨

* page.js
  + props
    - params: [...id]μ™€ κ°™μ€ λ™μ  λΌμ°νΈ νλΌλ―Έν„° κ°’
    - searchParams

* error.js
  + λ μ΄μ•„μ›ƒμ—μ„ μ—λ¬κ°€ λ°μƒν•  κ²½μ° λ™μΌ μ„κ³„μ error μ»΄ν¬λ„νΈλ΅ μ΄λ™ν•μ§€ μ•μ
    - <layout><error>{children}</error></layout> κ°™μ€ κµ¬μ΅°μ΄κΈ° λ•λ¬Έ
    - λ£¨νΈ λ μ΄μ•„μ›ƒμ—μ„ λ°μƒν• μ—λ¬ μ²λ¦¬λ¥Ό μ„ν•΄μ„  `app/global-error.js` νμ΄μ§€λ¥Ό μ΄μ©

## λ¦¬μ•΅νΈ μ„λ²„ μ»΄ν¬λ„νΈ

### κΈ°μ΅΄ λ¦¬μ•΅νΈ μ»΄ν¬λ„νΈμ™€ μ„λ²„ μ‚¬μ΄λ“ λ λ”λ§μ ν•κ³„

* κΈ°μ΅΄μ νλ¦„
  + λ¦¬μ•΅νΈ μ‹¤ν–‰μ— ν•„μ”ν• μ½”λ“λ¥Ό λ‹¤μ΄λ΅λ“ν•κ³  > λ¦¬μ•΅νΈ μ»΄ν¬λ„νΈ νΈλ¦¬λ¥Ό λ§λ“¤κ³  > DOMμ— λ λ”λ§
  + μ„λ²„μ—μ„ DOMμ„ λ§λ“¤μ–΄ μ¤κ³  > ν΄λΌμ΄μ–ΈνΈμ—μ„ λ§λ“¤μ–΄μ§„ DOMμ„ κΈ°μ¤€μΌλ΅ ν•μ΄λ“λ μ΄μ… > λΈλΌμ°μ €μ—μ„ μƒνƒλ¥Ό μ¶”μ ν•κ³  μ΄λ²¤νΈ ν•Έλ“¤λ¬λ¥Ό DOMμ— μ¶”κ°€

* ν•κ³„μ 
  + μλ°”μ¤ν¬λ¦½νΈ λ²λ“¤ ν¬κΈ°κ°€ 0μΈ μ»΄ν¬λ„νΈλ¥Ό λ§λ“¤ μ μ—†μ
    - λ§μ•½ μ„λ²„μ—μ„λ§ λ λ”λ§ν•κ³  ν΄λΌμ΄μ–ΈνΈμ—μ„λ” κ²°κ³Όλ§ λ°›λ”λ‹¤λ©΄?
  + λ°±μ—”λ“ λ¦¬μ†μ¤μ— λ€ν• μ§μ ‘μ μΈ μ ‘κ·Όμ΄ λ¶κ°€λ¥
  + μλ™ μ½”λ“ λ¶„ν• μ΄ λ¶κ°€λ¥
    - React.lazyλ¥Ό μ΄μ©ν•΄ μλ™ λ¶„ν• ν•  μ μμ§€λ§, κ°λ°μκ°€ κΈ°μ–µν•΄μ•Ό ν•¨
  + μ½”λ“ μ¶”μƒν™”μ— λ“λ” λΉ„μ©μ΄ μ¦κ°€ν•¨
    - κ²°κ³ΌμΈ JSXλ” λ‹¨μν•μ§€λ§ λ‚΄λ¶€ λ™μ‘μ΄ λ§μ„ λ•, μ„λ²„μ— μ„μ„ν•΄ ν΄λΌμ΄μ–ΈνΈμ μ†λ„λ¥Ό λ†’ν μ μμ

κ²°κµ­ μ„λ²„ μ‚¬μ΄λ“ λ λ”λ§, ν΄λΌμ΄μ–ΈνΈ μ‚¬μ΄λ“ λ λ”λ§ λ¨λ‘ μ΄ λ¬Έμ λ“¤μ„ ν•΄κ²°ν•κΈ°μ—λ” μ΅°κΈμ”© μ•„μ‰¬μ›€
* μ„λ²„ μ‚¬μ΄λ“ λ λ”λ§μ μ •μ  μ½ν…μΈ λ¥Ό λΉ λ¥΄κ² μ κ³µν•κ³ , μ„λ²„μ— μλ” λ°μ΄ν„°λ¥Ό μ†μ‰½κ² μ κ³µν•λ” μ¥μ 
* ν΄λΌμ΄μ–ΈνΈ μ‚¬μ΄λ“ λ λ”λ§μ€ μ‚¬μ©μ μΈν„°λ™μ…μ— λ”°λΌ λ‹¤μ–‘ν• κ²ƒλ“¤μ„ μ κ³µν•  μ μλ” μ¥μ 

μ΄ λ‘ κµ¬μ΅°μ μ¥μ μ„ λ¨λ‘ μ·¨ν•κ³ μ ν•λ” κ²ƒμ΄ λ¦¬μ•΅νΈ μ„λ²„ μ»΄ν¬λ„νΈ

### μ„λ²„ μ»΄ν¬λ„νΈ

* μ„λ²„ μ»΄ν¬λ„νΈ
  + μ”μ²­μ΄ μ¤λ©΄ κ·Έ μκ°„ μ„λ²„μ—μ„ λ”± ν• λ² μ‹¤ν–‰λ  λΏμ΄λ―€λ΅ μƒνƒλ¥Ό κ°€μ§ μ μ—†μ
  + λ λ”λ§ μƒλ…μ£ΌκΈ° μ‚¬μ© μ•λ¨
  + μ‚¬μ©μ μ •μ ν›… X
  + DOM API X
  + λ°μ΄ν„°λ² μ΄μ¤, λ‚΄λ¶€ μ„λΉ„μ¤, νμΌ μ‹μ¤ν…μ— μ ‘κ·Ό κ°€λ¥
  + λ‹¤λ¥Έ μ„λ²„ μ»΄ν¬λ„νΈ, JSX νΉμ€ ν΄λΌμ΄μ–ΈνΈ μ»΄ν¬λ„νΈλ¥Ό λ λ”λ§ ν•  μ μμ

* ν΄λΌμ΄μ–ΈνΈ μ»΄ν¬λ„νΈ
  + λΈλΌμ°μ € ν™κ²½μ—μ„λ§ μ‹¤ν–‰λμ–΄ μ„λ²„ μ»΄ν¬λ„νΈλ¥Ό λ¶λ¬μ¤κ±°λ‚, μ„λ²„ μ „μ© ν›…μ΄λ‚ μ ν‹Έλ¦¬ν‹°λ¥Ό λ¶λ¬μ¬ μ μ—†μ
  + ν΄λΌμ΄μ–ΈνΈ μ»΄ν¬λ„νΈκ°€ μμ‹μΌλ΅ μ„λ²„ μ»΄ν¬λ„νΈλ¥Ό κ°–λ” κµ¬μ΅°λ” κ°€λ¥ν•¨
    - μ„λ²„ μ»΄ν¬λ„νΈλ” μ΄λ―Έ μ„λ²„μ—μ„ λ§λ“¤μ–΄μ§„ νΈλ¦¬λ¥Ό κ°€μ§€κ³  μμ„ κ²ƒμ΄κ³ , ν΄λΌμ΄μ–ΈνΈ μ»΄ν¬λ„νΈλ” κ·Έ νΈλ¦¬λ¥Ό μ‚½μ…ν•΄μ„ λ³΄μ—¬μ£ΌκΈ°λ§ ν•κΈ° λ•λ¬Έ
  + λ‚λ¨Έμ§€λ” μΌλ° μ»΄ν¬λ„νΈμ™€ λ™μΌν•¨

* κ³µμ© μ»΄ν¬λ„νΈ
  + μ„λ²„μ™€ ν΄λΌμ΄μ–ΈνΈ λ¨λ‘μ—μ„ μ‚¬μ©ν•  μ μμ
  + λ‘ μ»΄ν¬λ„νΈμ λ¨λ“  μ μ•½μ„ λ°›μ

* μ„λ²„ μ»΄ν¬λ„νΈλ¥Ό μ‚¬μ©ν•κΈ° μ„ν•΄μ„λ” λ²λ“¤λ¬λ‚ νΉμ • ν”„λ μ„μ›ν¬μ λ„μ›€μ„ λ°›λ” κ²ƒμ΄ ν•„μμ 
  + λ¦¬μ•΅νΈ ν€μ κ³µμ‹ μμ μ—μ„λ” μ„λ²„ λ²λ“¤λ§μ„ μ„ν•΄ `react-server-dom-webpack`μ„ λ§λ“¤μ–΄ ν™μ©ν•¨
  + μ„λ²„ μ»΄ν¬λ„νΈ μ μ• λ¬Έμ„μ—μ„λ” λ…Έκ³¨μ μΌλ΅ Next.js ν€κ³Ό ν‘μ—…ν•κ³  μμμ„ μ–ΈκΈ‰
  

### μ„λ²„ μ‚¬μ΄λ“ λ λ”λ§κ³Ό μ„λ²„ μ»΄ν¬λ„νΈμ μ°¨μ΄

* μ„λ²„ μ‚¬μ΄λ“ λ λ”λ§μ λ©μ μ€ μ΄κΈ°μ— μΈν„°λ ‰μ…μ€ λ¶κ°€λ¥ν•μ§€λ§ μ •μ μΈ HTMLμ„ λΉ λ¥΄κ² λ‚΄λ ¤μ£Όλ” λ° μ΄μ μ„ λ‘κ³  μμ
  + λ”°λΌμ„ μ—¬μ „ν μ΄κΈ° HTMLμ΄ λ΅λ”©λ μ΄ν›„μ—λ” ν΄λΌμ΄μ–ΈνΈμ—μ„ μλ°”μ¤ν¬λ¦½νΈ μ½”λ“λ¥Ό λ‹¤μ΄λ΅λ“, νμ‹±, μ‹¤ν–‰ν•λ” λ° λΉ„μ©μ΄ λ“¬

* μ΄ν›„μ—λ” μ„λ²„ μ‚¬μ΄λ“ λ λ”λ§κ³Ό μ„λ²„ μ»΄ν¬λ„νΈλ¥Ό λ¨λ‘ μ±„νƒν•λ” κ²ƒλ„ κ°€λ¥ν•΄μ§ κ²ƒ

* κ²°λ΅ μ μΌλ΅ λ‘μ€ λ€μ²΄μ κ°€ μ•„λ‹ μƒνΈλ³΄μ™„ν•λ” κ°λ…
  + λ¦¬μ•΅νΈ ν€μ—μ„λ„ λ―Έλμ—λ” λ‘ κ°€μ§€ κΈ°λ²•μ΄ λ¨λ‘ μ“°μΌ μ μλ” κ°€λ¥μ„±μ„ μ•”μ‹ν•κ³  μμ

### μ„λ²„ μ»΄ν¬λ„νΈλ” μ–΄λ–»κ² μ‘λ™ν•λ”κ°€?

1. μ„λ²„κ°€ λ λ”λ§ μ”μ²­μ„ λ°›μ
2. μ„λ²„λ” λ°›μ€ μ”μ²­μ— λ”°λΌ μ»΄ν¬λ„νΈλ¥Ό JSONμΌλ΅ μ§λ ¬ν™” ν•¨.
   1. μ„λ²„μ—μ„ λ λ”λ§ν•  μ μλ” κ²ƒμ€ μ§λ ¬ν™”ν•΄μ„ λ‚΄λ³΄λ‚΄κ³ 
   2. ν΄λΌμ΄μ–ΈνΈ μ»΄ν¬λ„νΈλ΅ ν‘μ‹λ λ¶€λ¶„μ€ ν”λ μ΄μ¤ν™€λ” ν•μ‹μΌλ΅ λΉ„μ›λ‘ 
   3. λΈλΌμ°μ €λ” μ΄ κ²°κ³Όλ¬Όμ„ λ°›μ•„ μ—­μ§λ ¬ν™”ν• λ‹¤μμ— λ λ”λ§μ„ μν–‰ν•¨
   4. μ΄μ²λΌ μ„λ²„μ—μ„λ” ν΄λΌμ΄μ–ΈνΈμ—μ„ λ¦¬μ•΅νΈ μ»΄ν¬λ„νΈ νΈλ¦¬ κµ¬μ„±μ— ν•„μ”ν• μ •λ³΄λ¥Ό μµλ€ν• λ§μ΄, κ·Έλ¦¬κ³  κ²½μ μ μΈ ν¬λ§·μΌλ΅ ν΄λΌμ΄μ–ΈνΈμ— μ „λ‹¬ν•¨
3. λΈλΌμ°μ €κ°€ λ¦¬μ•΅νΈ μ»΄ν¬λ„νΈ νΈλ¦¬λ¥Ό κµ¬μ„±ν•¨

μ΄ μ‘λ™ λ°©μ‹μ νΉλ³„ν• μ 

* μ„λ²„μ—μ„ λ³΄λ‚Ό λ• μ¤νΈλ¦¬λ° ν•νƒλ΅ λ³΄λƒ„μΌλ΅μ¨ μ¤„ λ‹¨μ„λ΅ JSONμ„ μ½κ³  μ»΄ν¬λ„νΈλ¥Ό λ λ”λ§ν•  μ μμ–΄ λλ„λ΅ λΉ¨λ¦¬ κ²°κ³Όλ¬Όμ„ λ³΄μ—¬μ¤„ μ μμ
* κ° μ»΄ν¬λ„νΈλ³„λ΅ λ²λ“¤λ§μ΄ λ³„κ°λ΅ λΌ μμ–΄, ν•„μ”μ— λ”°λΌ μ»΄ν¬λ„νΈλ¥Ό μ§€μ—°ν•΄μ„ λ°›κ±°λ‚ λ”°λ΅ λ°›μ„ μ μμ
* μ„λ²„ μ‚¬μ΄λ“ λ λ”λ§κ³Ό λ‹¬λ¦¬ κ²°κ³Όλ¬Όμ΄ HTMLμ΄ μ•„λ‹ JSON ν•νƒλ΅ λ³΄λ‚΄μ§
  + λ¦¬μ•΅νΈ μ»΄ν¬λ„νΈ κµ¬μ΅°λ¥Ό λ°›μ•„ λ¦¬μ•΅νΈ νΈλ¦¬μ κµ¬μ„±μ„ μµλ€ν• λΉ λ¥΄κ² ν•  μ μλ„λ΅ λ„μ™€μ¤

```
μ΄λ¬ν• νΉμ§•μΌλ΅ μ„λ²„ μ»΄ν¬λ„νΈλ΅ ν΄λΌμ΄μ–ΈνΈ μ»΄ν¬λ„νΈλ΅ propsλ¥Ό λ„κΈΈ λ• λ°λ“μ‹ μ§λ ¬ν™” κ°€λ¥ν• λ°μ΄ν„°λ¥Ό λ„κ²¨μ•Ό ν•λ” μ μ•½μ΄ μƒκΉ€
```

### Next.jsμ—μ„μ λ¦¬μ•΅νΈ μ„λ²„ μ»΄ν¬λ„νΈ

* getServerSideProps, getStaticProps, getInitialProps μ‚­μ 
  + fetchλ΅ λ€μ²΄

* λ¦¬μ•΅νΈ ν€μ—μ„λ” fetch APIλ¥Ό ν™•μ¥ν•΄
  + μ„λ²„ μ»΄ν¬λ„νΈ νΈλ¦¬ λ‚΄μ—μ„ λ™μΌν• μ”μ²­μ΄ μλ‹¤λ©΄ μ¬μ”μ²­ν•μ§€ μ•κ³  μΊμ‹±λ κ²°κ³Όλ¥Ό μ‚¬μ©ν•λ„λ΅ ν•¨

> π¤ μ±…μ—μ„ 2023λ…„ 5μ›” κΈ°μ¤€μΌλ΅λ” νƒ€μ…μ¤ν¬λ¦½νΈκ°€ λΉ„λ™κΈ° μ»΄ν¬λ„νΈλ¥Ό μ§€μ›ν•μ§€ μ•μ•λ‹¤κ³  ν•λ”λ°
> νƒ€μ…μ¤ν¬λ¦½νΈ 5.1.3. @types/react 18.2.8 μ—μ„λ” μ§€μ›ν•λ‹¤ ν•©λ‹λ‹¤
> https://nextjs.org/docs/app/building-your-application/configuring/typescript#async-server-component-typescript-error

### μ •μ  λ λ”λ§κ³Ό λ™μ  λ λ”λ§

* κΈ°λ³Έμ μΌλ΅ λΉλ“ νƒ€μ„μ— λ λ”λ§μ„ λ―Έλ¦¬ ν•΄λ‘ 
  + μ΄λ¥Ό μ”μ²­λ§λ‹¤ fetchν•κ³  μ‹¶λ‹¤λ©΄ `cache: 'no-cache` μµμ…μΌλ΅ fetchλ¥Ό μ‚¬μ©ν•λ©΄ λ¨
  + νΉμ€ next/headersλ‚ next/cookie κ°™μ€ ν•¨μλ¥Ό μ‚¬μ©ν•λ©΄, λ™μ μΈ μ—°μ‚°μ„ λ°”νƒ•μΌλ΅ κ²°κ³Όλ¥Ό λ°ν™ν•λ” κ²ƒμΌλ΅ μΈμ‹ν•΄ μ •μ  λ λ”λ§ λ€μƒμ—μ„ μ μ™Έλ¨

* λ™μ μΈ μ£Όμ†μ΄μ§€λ§ νΉμ • μ£Όμ†μ— λ€ν•΄ μΊμ‹±ν•κ³  μ‹¶μ€, getStaticPathsλ¥Ό ν‰λ‚΄λ‚΄κ³  μ‹¶λ‹¤λ©΄?
  + `generateStaticParams`λ¥Ό μ‚¬μ©ν•λ©΄ λ¨
  + https://nextjs.org/docs/app/api-reference/functions/generate-static-params

```
fetch(URL, { cache: 'force-cache' })
- getStaticProps, λ¶λ¬μ¨ λ°μ΄ν„°λ΅λ§ κ΄€λ¦¬

fetch(URL, { cache: 'force-cache' }),
fetch(URL, { next: {revalidate: 0} })
- getServerSideProps, μΊμ‹±ν•μ§€ μ•κ³  λ§¤λ² μƒλ΅μ΄ λ°μ΄ν„°λ¥Ό λ¶λ¬μ΄

fetch(URL, { next: {revalidate: 10} })
- ISR, μ •ν•΄μ§„ μ‹κ°„ λ™μ•μ— μΊμ‹±λ κ°’μ„ λ°ν™ν•κ³  μ΄ν›„ μΊμ‹λ¥Ό νκΈ°
```

### μ¤νΈλ¦¬λ―•μ„ ν™μ©ν• μ μ§„μ μΈ νμ΄μ§€ λ¶λ¬μ¤κΈ°

* app/loading.jsλ” Suspense κΈ°λ°

### μ„λ²„ μ•΅μ…

```tsx
async function serverAction() {
  "use server";
}

// or

"use server";

async function serverAction() {}
```

* μ΄λ²¤νΈλ¥Ό λ°μƒμ‹ν‚¤λ” κ²ƒμ€ ν΄λΌμ΄μ–ΈνΈμ§€λ§, μ‹¤μ λ΅ ν•¨μ μμ²΄κ°€ μν–‰λλ” κ²ƒμ€ μ„λ²„
  + μ„λ²„ μ•΅μ…μ„ ν΄λΌμ΄μ–ΈνΈμ—μ„ μ‹¤ν–‰μ‹ λ„¤νΈμ›ν¬ νƒ­μ—μ„λ” ν„μ¬ λΌμ°νΈ μ£Όμ†μ™€ ACTIONS_IDλ§ λ³΄λƒ„
  + μ΄λ¥Ό μ΄μ©ν•΄ μ„λ²„μ—μ„ μ§μ ‘ μ‹¤ν–‰ν•¨
  + ν΄λΌμ΄μ–ΈνΈ λ²λ“¤λ§ κ²°κ³Όλ¬Όμ— ν¬ν•¨λμ§€ μ•μ

* server mutation
  + 'next/nagivation'μ redirect
  + 'next/cache'μ revalidatePathμ™€ revalidateTag

* μ£Όμμ 
  + μ„λ²„ μ•΅μ…μ€ ν΄λΌμ΄μ–ΈνΈ μ»΄ν¬λ„νΈ λ‚΄μ—μ„ μ •μν•  μ μ—†μ
    - ν•μ§€λ§ μ„λ²„ μ•΅μ…λ§ λ¨μ—¬ μλ” νμΌμ—μ„ importν•κ±°λ‚, propsλ΅ λ°›μ•„ useTransitionκ³Ό ν•¨κ» μ‚¬μ©ν•  μ μμ

> π¤ μ‹¤μ‚¬μ© μ½”λ“λ³΄λ©΄μ„ μ €λ” μ‹¬μ  ν‘μƒμ„ μ΅λ” νΈμΈλ° ...
> https://github.com/gabrielelpidio/next-infinite-scroll-server-actions
> μ΄κ² κΈ°μ–µμ΄ λ‚ λ‚¨κ²¨λ΄…λ‹λ‹¤..

## μ •λ¦¬

λ¦¬μ•΅νΈμ μ„λ²„ μ»΄ν¬λ„νΈλ” μ΄μ „μ— μ—†μ—λ μ™„μ „ν μƒλ΅μ΄ ν¨λ¬λ‹¤μ„μΌλ΅, μ•μΌλ΅μ λ¦¬μ•΅νΈ μƒνƒκ³„μ— λ§μ€ λ³€ν™”λ¥Ό κ°€μ Έμ¬ κ²ƒμΌλ΅ λ³΄μ„

κ·Έμ— λ”°λΌ ν”„λ°νΈμ—”λ“ κ°λ°μλ“¤μ—κ² Node.jsλ¥Ό μ„μ‹ν•λ” μ„λ²„ ν™κ²½μ μ΄ν•΄κ°€ μ¤‘μ”ν•΄μ§ κ²ƒ

λ‹¤κ°€μ¤λ” λ³€ν™”μ— μ•μ„ λ¨Όμ € μ²΄ν—ν•΄ λ³΄κ³ , κ°λ° μ¤‘μΈ μ• ν”λ¦¬μΌ€μ΄μ…μ λ¬Έμ μ μ„ μ–΄λ–»κ² ν•΄κ²°ν•κ³  μ„±λ¥μ„ κ°μ„ ν•  μ μμ„μ§€ κ³ λ―Όν•΄ λ³΄λ©΄ μΆ‹μ„ κ²ƒμ΄λ‹¤
